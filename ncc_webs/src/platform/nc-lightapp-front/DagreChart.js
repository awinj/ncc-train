(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[1],{890:function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0});t.flowFormatNode=function(e){return e.map(function(e,t){return{id:e.act_id,label:{text:e.label},name:e.act_name}})},t.createEdges=function(e){switch(e.isForward){case"0":var t=e.source.map(function(t){return{source:t,target:e.id}}),r=e.target.map(function(t){return{source:e.id,target:t}});return[].concat(n(t),n(r));case"1":return e.target.map(function(t){return{source:e.id,target:t}});case"-1":return e.source.map(function(t){return{source:t,target:e.id}});default:return[]}},t.dragNodeChangePostion=function(e){var t=void 0,r=void 0,n=void 0;e.on("node:dragstart",function(e){var o=e.item,a=o.getModel();t=o,r=a.x-e.x,n=a.y-e.y}),e.on("node:drag",function(o){t&&e.update(t,{x:o.x+r,y:o.y+n})}),e.on("node:dragend",function(e){t=void 0})},t.generateInitSelected=function(e){return e.filter(function(e,t){return e.ispassroute})},t.equalArray=function(e,t){return!(!e||!t)&&"Array"===Object.prototype.toString.call(e).slice(8,-1)&&"Array"===Object.prototype.toString.call(t).slice(8,-1)&&JSON.stringify(e)===JSON.stringify(t)}},891:function(e,t,r){var n;window,e.exports=(n=r(465),function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=265)}({265:function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=r(3),a=o.Util,i=function(){function e(e){this.options=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){n(e,t,r[t])})}return e}({dx:10,dy:10,getTooltip:function(e){var t=e.item;if(t){var r=t.getModel().tooltip;if(r){var n="",o=t.type;return a.isArray(r)?r.forEach(function(e){n+='<li style="font-size: 12px;list-style-type: none;"><span>'+e[0]+"</span>: "+e[1]+"</li>"}):(o=r.title,r.list.forEach(function(e){n+='<li style="font-size: 12px;list-style-type: none;"><span>'+e[0]+"</span>: "+e[1]+"</li>"})),'\n              <div class="g6-tooltip" style="\n                position: absolute;\n                white-space: nowrap;\n                zIndex: 8;\n                transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);\n                background-color: rgba(255, 255, 255, 0.9);\n                box-shadow: 0px 0px 10px #aeaeae;\n                border-radius: 3px;\n                color: rgb(87, 87, 87);\n                line-height: 20px;\n                padding: 10px 10px 6px 10px;\n              ">\n                <h4 class="g6-tooltip-title" style="\n                  margin: 0;\n                ">'+o+'</h4>\n                <ul class="g6-tooltip-list" style="\n                  padding: 0;\n                  margin: 0;\n                  margin-top: 4px;\n                ">\n                  '+n+"\n                </ul>\n              </div>\n            "}}return null}},e)}var t=e.prototype;return t.init=function(){var e=this,t=this.graph;t.on("mouseenter",function(t){t.shape&&e.onMouseEnter(t)}),t.on("mousemove",function(t){e.onMouseMove(t)}),t.on("mouseleave",function(t){e.onMouseLeave(t)})},t.onMouseEnter=function(e){var t=this.graph.getGraphContainer(),r=this.options.getTooltip(e),n=this.tooltip;n&&this.tooltip.destroy(),r?((n=a.createDOM(r)).css({position:"absolute"}),t.appendChild(n)):n=null,this.tooltip=n},t.onMouseMove=function(e){var t=e.domX,r=e.domY,n=this.tooltip;if(n){var o=this.graph,i=a.getOuterWidth(n),l=a.getOuterHeight(n),c=o.getWidth(),s=o.getHeight();n.css({top:this._getTop(l,s,r),left:this._getLeft(i,c,t)})}},t.onMouseLeave=function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)},t._getTop=function(e,t,r){var n=this.options.dy;return 2*e>=t?"0px":r<e+n?r+n+"px":r-e-n+"px"},t._getLeft=function(e,t,r){var n=this.options.dx;return 2*e>=t?"0px":t-r-n<e?r-e-n+"px":r+n+"px"},t.destroy=function(){this.tooltip&&this.tooltip.destroy()},e}();o.Plugins["tool.tooltip"]=i,e.exports=i},3:function(e,t){e.exports=n}}))},894:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),a=s(o),i=r(14),l=s(r(12)),c=r(890);function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}r(891);var d=r(465),p=r(700);d.track(!1);var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.getDrawDagreData=function(e){var t={nodes:e,edges:[]};e.forEach(function(e){var r;return(r=t.edges).push.apply(r,u((0,c.createEdges)(e)))}),r.setState({data:t,extract:!1},function(){r.renderDagre(r.changeColor(r.state.data))})},r.renderShape=function(e,t){if("react"===t)return e.registerNode("rect",{getPath:function(t){return e.Util.getRectPath(-68,-25,136,50,10)}})},r.initDagre=function(){r.renderShape(d,"react"),r.dagre=new p["layout.dagre"]({rankdir:"LR",nodesep:30,ranksep:30}),r.tooltip=new d.Plugins["tool.tooltip"]({getTooltip:function(e){var t=e.item.getModel();if(t)return'<ul class="dagre-toolTip">\n\t\t\t\t\t\t\t\t<li class="dagre-toolTip-title">单据名称: '+t.billTypeName+'</li>\n\t\t\t\t\t\t\t\t<li class="dagre-toolTip-billcode">单据编号: '+t.billCode+"</li>\n\t\t\t\t\t\t\t</ul>"}}),r.graph=new d.Graph({id:"mountNode",heigth:250,plugins:[r.dagre,r.tooltip],defaultIntersectBox:"rect",modes:{default:["panBlank","panNode","wheelZoom"]}}),r.graph.edge({style:{endArrow:!0},label:function(e){return e.shape},size:1}),r.graph.node({shape:"rect",style:{stroke:"#CCEAFF"}}),r.itemClickEvent(),r.graph.on("wheel",function(e){var t=r.graph.getZoom();r.setState({wheelScrollZoom:t})})},r.calculaterGraphPosition=function(e){var t=r.graph,n=[],o=0,a=0;if(e.nodes.length>1){if(console.log("多个节点"),e.nodes.forEach(function(e){e.source.length&&n.push(e.source),e.target.length&&n.push(e.target)}),n.length){o=n.length+1;var i=[];n.forEach(function(e,t){i.push(e.length)}),i.sort(function(e,t){return t-e});var l=136*o+30*(o-1),c=50*(a=i[0])+30*(a-1),s=document.querySelector(".dagreScrollWrap");if(s&&r.firstRender){var u=s.clientHeight,d=s.clientWidth;r.dagreScrollWrapHeight=u,r.dagreScrollWrapWidth=d;var p=(u-c)/2,f=(d-l)/2;r.dagreScrollWrapHeight&&(f>=0&&p>=0?t.translate(f,p):f>=0&&p<=0?t.translate(f,0):p>=0&&f<=0&&t.translate(0,p),r.setState({graphWidth:l,graphHeight:c}),r.firstChangeZoom=!0,r.firstRender=!1)}}}else if(1===e.nodes.length){console.log("一个节点");var g=document.querySelector(".dagreScrollWrap");if(g&&r.firstRender){var h=g.clientHeight,y=g.clientWidth;r.dagreScrollWrapHeight=h,r.dagreScrollWrapWidth=y;var v=(h-50)/2,m=(y-136)/2;t.translate(m,v),r.setState({graphWidth:136,graphHeight:50}),r.firstRender=!1,r.firstChangeZoom=!0}}},r.renderDagre=function(e){r.calculaterGraphPosition(e);var t=r.graph;(0,c.dragNodeChangePostion)(t),t.read(e),t&&r.currentZoom&&t.zoom(r.currentZoom)},r.itemClickEvent=function(){r.graph.on("click",function(e){if(e.item&&e.item.isNode){var t=e.item.id;if(t!==r.state.selectedId)if(r.setState({selectedId:t},function(){r.props.getSelectId&&r.props.getSelectId(t)}),r.state.extract){var n=r.changeColor(r.state.relatedData);r.setState({relatedData:n},function(){return r.renderDagre(n)})}else{var o=r.changeColor(r.state.data);r.setState({data:o},function(){return r.renderDagre(o)})}}}),r.graph.on("dblclick",function(e){if(e.item&&"node"===e.item.type){var t=e.item.model.id,n=r.state.data.nodes.find(function(e){return e.id==t}).type,o=r.state.data.nodes.find(function(e){return e.id==t}).transtype;r.props.onSelect&&r.props.onSelect(t,n,o)}})},r.changeColor=function(e){r.currentZoom=r.graph.getZoom(),e.nodes.forEach(function(e){e&&e.color&&(e.color="#fff")}),e.edges.forEach(function(e){e&&e.color&&(e.color="#888")});var t=r.state,n=t.selectedId,o=t.extract,a=t.relatedData;if(n){var i=r.getRelated(n,r.state.data),l=o?r.getRelated(n,a):{nodes:[],edges:[]},c=[].concat(u(i.nodes),u(l.nodes)),s=[].concat(u(i.edges),u(l.edges));c&&(c.forEach(function(e){e&&(e.id===r.state.selectedId?(e.label&&e.label.fill&&(e.label.fill="#007ACE"),e.color="#CCEAFF"):(e.label&&e.label.fill&&(e.label.fill="#F87321"),e.color="#FFE19D"))}),s.forEach(function(e){e&&e.color&&(e.color="green")}))}return e},r.getRelated=function(e,t){var r=[],n=[],o=[];!function e(o){var a,i=t.edges.filter(function(e){return e.target===o}),l=i.map(function(e){return e.source});(a=r).push.apply(a,u(i)),n.push.apply(n,u(l)),l.length>0&&l.forEach(function(t){return e(t)})}(e),function e(n){var a,i=t.edges.filter(function(e){return e.source===n}),l=i.map(function(e){return e.target});(a=r).push.apply(a,u(i)),o.push.apply(o,u(l)),l.length>0&&l.forEach(function(t){return e(t)})}(e),r=[].concat(u(new Set(r)));var a=[].concat(u(new Set([].concat(n,[e],o)))).map(function(e){return t.nodes.find(function(t){return t.id===e})});return{edges:r,nodes:a}},r.handleClick=function(){var e=r.props.extractTip;r.state.extract?(r.setState({extract:!r.state.extract}),r.renderDagre(r.state.data)):r.state.selectedId?r.setState({extract:!r.state.extract,relatedData:r.getRelated(r.state.selectedId,r.state.data)},function(){var e=r.changeColor(r.state.relatedData);r.renderDagre(e)}):(0,l.default)({color:"warning",content:e})},r.calculatePostionbBeforeRender=function(e){var t=r.state,n=t.graphHeight,o=t.graphWidth,a=t.wheelScrollZoom;setTimeout(function(){var t=document.querySelector(".dagreScrollWrap");if(t){var i=t.clientHeight,l=t.clientWidth;if(i-n>=0)if(r.dagreScrollH){if(n&&!1===e&&!r.hasTableDy){var c=(i-n)/2,s=c-(2*i-n)/2;r.hasTableDy=c,r.graph.translate(0,s),r.prevDy=s}}else r.dagreScrollH=i;else if(i-n<0&&i&&(r.dagreScrollH=n,r.firstChangeZoom)){r.firstChangeZoom=!1;var u=l/o,d=i/n;r.currentZoom=u<d?u:d,a?r.graph.zoom(a):r.graph.zoom(r.currentZoom)}l-o>=0?r.dagreScrollW||(r.dagreScrollW=l):r.dagreScrollW||(r.dagreScrollH=o)}},50)},r.state={data:{nodes:r.props.list,edges:(0,c.createEdges)(r.props.list)},selectedId:r.props.selectedId||"",extract:!1,relatedData:null,graphHeight:0,graphWidth:0,wheelScrollZoom:null},r.dagre=null,r.tooltip=null,r.graph=null,r.currentZoom=null,r.firstRender=!0,r.dagreScrollH=null,r.dagreScrollW=null,r.dagreScrollWrapHeight=0,r.dagreScrollWrapWidth=0,r.firstChangeZoom=!1,r.hasTableDy=null,r.prevDy=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),n(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.list;"BillTrack"!==e.parentCom&&this.getDrawDagreData(t)}},{key:"componentDidMount",value:function(){this.initDagre(),this.props.getSelectId&&this.props.getSelectId(this.state.selectedId)}},{key:"componentWillReceiveProps",value:function(e){var t=e.list,r=e.size;this.getDrawDagreData(t),void 0!==r&&r!==this.props.size&&(1==r?this.graph.translate(0,-this.prevDy):this.graph.translate(0,this.prevDy))}},{key:"render",value:function(){var e=this.props,t=e.size,r=e.extractBtns,n=void 0;return r&&(n=this.state.extract?r[0]:r[1]),this.calculatePostionbBeforeRender(t),a.default.createElement("div",{className:(this.props.className?this.props.className:"")+" dagre-area ",style:{height:t?"96%":"50%"}},n&&a.default.createElement(i.NCButton,{className:"button-primary dagre-extract",onClick:this.handleClick},n),a.default.createElement("div",{className:"dagreScrollWrap"},a.default.createElement("div",{className:"dagreScroll",style:{height:this.dagreScrollH?this.dagreScrollH+"px":"100%",width:this.dagreScrollW?this.dagreScrollW+"px":"100%"}},a.default.createElement("div",{id:"mountNode",className:"dagre",style:{width:"100%"}}))))}}]),t}();t.default=f}}]);
//# sourceMappingURL=DagreChart.js.map