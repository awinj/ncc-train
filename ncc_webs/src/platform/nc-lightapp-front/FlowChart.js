(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[2],{892:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e){if(!e.length)return[];var t={},n=[],o=e.filter(function(e,o){return e.startnode?(t=r({},e),o):e.isendnode&&(n.push(e),o),!e.startnode&&!e.isendnode});return Object.keys(t).length&&o.unshift(t),n.length&&(o=o.concat(n)),o},a=function(e){var t=o(e);if(!t.length)return[];var n=-1,r=-1,a=!0,i="",s=t.map(function(e,t){return e.ispassroute||!a||e.startnode||e.isendnode?!e.ispassroute||e.startnode||e.isendnode||(n=t):(a=!1,r=t),e.isPass&&!e.startnode&&!e.isendnode}),l=t.find(function(e,t){return!e.ispassroute&&!e.startnode&&!e.isendnode}),d=t.find(function(e,t){return e.hasOwnProperty("isCurrentNode")&&e.isCurrentNode&&(i=t+","),e.isCurrentNode}),c=t.find(function(e,t){return e.isfinished});return(!c||!Object.keys(c).length)&&(d&&Object.values(d)?i.substring(0,i.length-1):!l&&Object.keys(s).length?t.length-2:!(!s.length||0==r)&&(n>r?n:r-1))};t.flowFormatNode=function(e,t){var n=o(e);if(!n.length)return[];var r=a(n);return n.map(function(e,n){var o=e.act_name&&e.act_name.length>7?e.act_name.slice(0,7)+"...":e.act_name,a="#E5E5E5";return n==r||e.isCurrentNode?a="#FFDDDD":e.ispassroute&&(a="#A5D6FF"),{id:e.act_id?e.act_id:e.startnode?"isstart":"isend"+n,name:o||(e.startnode?t["006"]:t["007"]),x:e.dimension.split(";")[0],y:e.dimension.split(";")[1],color:a,ispassroute:e.ispassroute,style:{stroke:e.ispassroute?n==r?"#FF1414":"#0D68C3":"#9d9d9d"},label:{text:o||(e.startnode?t["006"]:t["007"]),fontSize:13},tipName:e.act_name?e.act_name:e.startnode?t["006"]:t["007"],billmaker:e.billmaker,actType:e.act_type_value||t["009"],mergeWay:e.merge_way||t["009"],branchWay:e.branch_way||t["009"],ismain:e.ismain||!1,isstart:e.isstart||!1,index:n}})},t.createEdges=function(e){var t=o(e);if(!t.length)return[];var n=[];return t.map(function(e,t){if(t>0){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e?e.includes(t)?e.split(t):e:"isstart"}(e.from_id);if(r instanceof Array)r.map(function(t){n.push({source:t,target:e.act_id,id:t+"-"+e.act_id,color:e.ispassroute?"#A3F3FF":"#D8D8D8",label:e.transition_name||""})});else{var o=e.from_id||"isstart",a=e.act_id||"isend"+t;n.push({source:o,target:a,id:o+"-"+a,color:e.ispassroute?"#A3F3FF":"#D8D8D8",label:e.transition_name||""})}}}),n},t.dragNodeChangePostion=function(e){var t=void 0,n=void 0,r=void 0;e.on("node:dragstart",function(e){var o=e.item,a=o.getModel();t=o,n=a.x-e.x,r=a.y-e.y}),e.on("node:drag",function(o){t&&e.update(t,{x:o.x+n,y:o.y+r})}),e.on("node:dragend",function(e){t=void 0})},t.generateInitSelected=function(e){var t=o(e),n=a(t);return n&&t.length?t.find(function(e,t){return n.toString().includes(",")?n.toString().includes(t):n==t}).act_id:""},t.equalArray=function(e,t){return!t||"Array"===Object.prototype.toString.call(e).slice(8,-1)&&"Array"===Object.prototype.toString.call(t).slice(8,-1)&&JSON.stringify(e)===JSON.stringify(t)}},893:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.renderShape=function(e,t){if("react"===t)return e.registerNode("rect",{getPath:function(t){return e.Util.getRectPath(-45,-15,90,30,6)}})}},895:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),i=f(a),s=(f(n(3)),f(n(465))),l=(f(n(16)),f(n(12))),d=f(n(0)),c=n(892),u=n(893),p=n(28);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}n(700);s.default.track(!1);var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={json:{},inlt:null,data:{nodes:[],edges:[]},selectedId:(0,c.generateInitSelected)(n.props.list||[]),originalSelectedId:(0,c.generateInitSelected)(n.props.list||[])},n.dagre=null,n.graph=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"componentDidMount",value:function(){var e=this;(0,p.getMultiLang)({moduleId:"containers_flowchart",callback:function(t,n,r){n?e.setState({json:t,inlt:r,data:{nodes:(0,c.flowFormatNode)(e.props.list||[],t),edges:(0,c.createEdges)(e.props.list||[])}},function(){e.initFlowChart(),e.expelSelectedId(),e.renderFlowChart(e.state.data,{initCenterPos:!0,shouldChangePos:!0})}):console.log("未加载 containers_flowchart.json 多语文件")}})}},{key:"componentWillReceiveProps",value:function(e){e.list&&!(0,c.equalArray)(e.list,this.props.list)&&this.renderFlowInitData(e.list),console.log("resetChart",e.resetChart),e.resetChart&&e.resetChart!=this.props.resetChart&&this.renderFlowChart(this.state.data,{initCenterPos:!0,shouldChangePos:!0})}},{key:"renderFlowInitData",value:function(e){var t=this,n={nodes:(0,c.flowFormatNode)(e,this.state.json),edges:(0,c.createEdges)(e)},r="";this.state.selectedId||(r=(0,c.generateInitSelected)(e)),this.setState({data:n,selectedId:r},function(){t.renderFlowChart(t.state.data)})}},{key:"expelSelectedId",value:function(){this.props.getSelectId&&r(this.props.getSelectId)&&this.props.getSelectId(this.state.selectedId,this.state.originalSelectedId)}},{key:"initFlowChart",value:function(){(0,u.renderShape)(s.default,"react"),this.graph=new s.default.Graph({container:"mountNode",height:205,fitView:"cc",plugins:[new s.default.Plugins["tool.tooltip"]({getTooltip:function(t){var n=t.item.getModel();return'<div class="tips-model">\n                            <p>'+e.state.json["000"]+": "+(n.tipName||"暂无")+"</p> \n                            <p>"+e.state.json["001"]+": "+(n.actType||"暂无")+"</p>\n                            <p>"+e.state.json["002"]+": "+(n.billmaker||"暂无")+"</p>\n                            <p>"+e.state.json["003"]+": "+(n.mergeWay||"暂无")+"</p>\n                            <p>"+e.state.json["004"]+": "+(n.branchWay||"暂无")+"</p>\n                        </div>"}}),new s.default.Plugins["tool.minimap"]({container:"mountNode",width:180,height:120})],defaultIntersectBox:"rect",modes:{default:["panBlank","panNode","wheelZoom"]}}),this.graph.edge({style:{endArrow:!0}});var e=this;this.graph.node({shape:"rect"}),e.props.readOnly||e.itemClickEvent()}},{key:"renderFlowChart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.graph.read(e),t.hasOwnProperty("initCenterPos")&&(this.state.selectedId?this.graph.focus(this.state.selectedId):this.graph.focus("isstart")),t.hasOwnProperty("shouldChangePos"),t.hasOwnProperty("scale")&&(this.graph.zoom(t.scale),t.hasOwnProperty("currId")&&this.graph.focus(t.currId)),this.props.resetChartSuccess&&"function"==typeof this.props.resetChartSuccess&&this.props.resetChartSuccess(!1)}},{key:"itemClickEvent",value:function(){var e=this,t=-1;this.graph.on("click",function(n){if(n.item&&n.item.isNode&&"isstart"!=n.item.model.id&&"isend"!=n.item.model.id)if(n.item.model.hasOwnProperty("isCurrentNode")&&(t=n.item.model.index),n.item.model.ispassroute){if(n.item.model.index>t&&-1!=t&&(0,l.default)({color:"warning",content:"待张寒定"}),n.item.isNode){var r=n.item.id;r!==e.state.selectedId&&e.setState({selectedId:r},function(){e.expelSelectedId()});var o=e.changeNodeColor(e.state.data,e.state.selectedId),a=e.graph.getZoom();e.setState({data:o},function(){e.renderFlowChart(o,{scale:a,currId:n.item.model.id})})}}else(0,l.default)({color:"warning",content:e.state.json["005"]})})}},{key:"changeNodeColor",value:function(e,t){[].concat(h(e.nodes),h(e.edges)).map(function(e,t){e.color=null});var n=e.nodes;e.edges;if(n)return n.forEach(function(e,n){e&&(e.id===t?(e.color="#ffDDDD",e.style.stroke="#FF1414"):e.ispassroute?e.ispassroute&&(e.color="#A5D6FF",e.style.stroke="#0D68C3"):(e.color="#E5E5E5",e.style.stroke="#9d9d9d"))}),e}},{key:"render",value:function(){return i.default.createElement("div",{className:"flow-chart-contain"},i.default.createElement("div",{id:"mountNode",className:"dagre"}))}}]),t}();g.propTypes={readOnly:d.default.boolean},g.defaultProps={readOnly:!1},t.default=g}}]);
//# sourceMappingURL=FlowChart.js.map