<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hrTree/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hrTree/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by wanghongxiang on 2018/7/26.
 */
import React, { Component } from 'react';
import ReactDOM from 'react-dom';
import PropTypes from 'prop-types';
import { base } from 'nc-lightapp-front';
import './index.less'
const { NCTree, NCFormControl} = base
const propTypes = {
    editType: PropTypes.boolean,
    treeData: PropTypes.array,
    config: PropTypes.object,
    event: PropTypes.object,
    onExpand: PropTypes.func,
    onCheck: PropTypes.func,
    expandedKeys: PropTypes.array,
    showSearch: PropTypes.boolean
};
const defaultProps = {
    config: {
        root:{
            title: '部门',
            key: 'null'
        },
        defaultExpandAll: true,
        checkable:false,
        showLine:true,
        datas: [],
        selectedKeys:  ['0-0'],
        openIcon: &lt;i className="icon iconfont icon-shu_zk">&lt;/i>,
        closeIcon: &lt;i className="icon iconfont icon-shushouqi">&lt;/i>,
        selectedNode: '0-0',
        showRoot:true,
        iconClassArr:['icon iconfont icon-biangengjilu','icon iconfont icon-zengjia add-icon','icon iconfont icon-shanchu delete-icon']
    },
    showSearch: false,
    onExpand: () => {},
    onCheck: () => {},
    expandedKeys: ['0-0'],
    checkedKeys: [],
    event: {
        editRender: (a, b, c)=>{
        },
        addRender: (a, b, c)=>{
        },
        delRender: (a, b, c)=>{
        }
    }
};
class Hrtree extends Component {
    constructor(props) {
        super(props)
        this.renderTreeTitle = this.renderTreeTitle.bind(this)
        this.events = Object.assign(defaultProps.event,this.props.event)
        this.editRender = this.events.editRender.bind(this)
        this.addRender = this.events.addRender.bind(this)
        this.delRender = this.events.delRender.bind(this)
        this.addIconBox = this.addIconBox.bind(this)
        this.onChange = this.onChange.bind(this)
        this.onExpand = this.onExpand.bind(this)
        this.onCheck = this.onCheck.bind(this)
        this.config = Object.assign(defaultProps.config,this.props.config)
    }
    state = {
        showTree: true,
        searchValue: null,
        defaultExpandAll: true,
        expandedKeys: ['0-0'],
        treeOriginData: null,
        checkedKeys: []
    }
    componentDidMount() {
        let obj = this.props.config.root
        obj.children = this.props.treeData
        this.setState({
            treeOriginData: [obj],
            expandedKeys: this.props.expandedKeys,
            checkedKeys: this.props.checkedKeys
        })
    }

    componentWillReceiveProps(nextprops) {
        let nexttreeData = JSON.stringify(nextprops.treeData);
        let thistreeData = JSON.stringify(this.props.treeData);
        if(nexttreeData !== thistreeData){
            let obj = nextprops.config.root
            obj.children = nextprops.treeData
            this.setState({
                showTree: false,
                treeOriginData: [obj],
                checkedKeys: nextprops.checkedKeys
            },()=>{
                this.setState({
                    showTree: true
                })
            })
        }
    }
    addIconBox (data){
        if (data &amp;&amp; data instanceof Array &amp;&amp; data.length > 0) {
            data.forEach((item) => {
                item.iconBox = {
                    addIcon: true,
                    delIcon: true,
                    editIcon: true
                };
                if (Array.isArray(item.children)) {
                    this.addIconBox(item.children);
                }
            });
        }
        return data
    }
    renderTreeTitle(item, editType) {
        let editIcon, titleInfo, addIcon, delIcon, iconBox, beforeName, afterName;
        //编辑图标
        let flag = item.flag ? item.flag : true;
        let addField = true;

        editType = this.config.editType;

        if (editType) {
            if (item.iconBox) {
                
                if (item.iconBox.editIcon &amp;&amp; item.code &amp;&amp; item.code != 'system') {
                    let icon = this.config.iconClassArr[0] ? 
                        this.config.iconClassArr[0] : '';

                    editIcon = (
                        &lt;i
                            field={addField ? 'editIcon' : null}
                            fieldname={addField ? '编辑' : null}
                            className={icon}
                            onClick={(e) => this.editRender.call(this, item, e, 'editIcon')}
                        />
                    );
                }
                if (item.iconBox.addIcon) {
                    let icon = this.config.iconClassArr[1] 
                        &amp;&amp; (flag == 2 || flag === true)? this.config.iconClassArr[1] : '';

                    addIcon = (
                        &lt;i
                            field={addField ? 'addIcon' : null}
                            fieldname={addField ? '新增' : null}
                            className={icon}
                            onClick={(e) => this.addRender.call(this, item, e, 'addIcon')}
                        />
                    );
                }
                if (item.iconBox.delIcon &amp;&amp; item.code &amp;&amp; item.code != 'system') {
                    let icon = this.config.iconClassArr[2]?this.config.iconClassArr[2]:'';
                    delIcon = (
                        &lt;i
                            field={addField ? 'delIcon' : null}
                            fieldname={addField ? '删除' : null}
                            className={icon}
                            onClick={(e) => this.delRender.call(this, item, e, 'delIcon')}
                        />
                    );
                }
            } else {
                console.warn('请设置iconBox属性，{editIcon, addIcon, delIcon}');
            }
        }
        iconBox = (
            &lt;span className="NC_iconBox">
                {editIcon} {addIcon} {delIcon}
            &lt;/span>
        );
        let iconClass = (&lt;i  style={{marginRight: '5px'}} class="tree-dian">&lt;/i>)
        if (Array.isArray(item.children)&amp;&amp; item.children.length > 0) {
            iconClass = (&lt;i style={{marginRight: '5px'}} class="icon iconfont icon-wenjianjia tree-wenjian">&lt;/i>)
        }
        titleInfo = &lt;span className={"title-middle " + item.className}>{iconClass}{item.refname || item.title}&lt;/span>;
        item.hasOwnProperty('beforeName') ? (beforeName = item.beforeName) : null;
        item.hasOwnProperty('afterName') ? (afterName = item.afterName) : null;

        return (
            &lt;div className="syncTreeCom">
                &lt;div className="title-con">
                    {beforeName}
                    {titleInfo}
                    {afterName}
                    {editType? iconBox : null}
                &lt;/div>
            &lt;/div>
        );
    };
    getParentKey(title, tree){
        let parentKey;
        for (let i = 0; i &lt; tree.length; i++) {
            const node = tree[i];
            if (node.children) {
                if (node.children.some(item => item.title === title)) {
                    parentKey = node.key;
                } else if (this.getParentKey(title, node.children)) {
                    parentKey = this.getParentKey(title, node.children);
                }
            }
        }
        return parentKey;
    };
    onExpand(expandedKeys) {
        this.setState({
            expandedKeys,
            autoExpandParent: true,
        });
    }
    onChange(value) {
        let expandedKeys = [];
        let currentSelectKeys = [];
        let uniqueExpandedKeys = [];
        if (value) {
            const getExpandKeys = (data) => {
                data.forEach((item) => {
                    if (item.title.indexOf(value) > -1) {
                        let p = this.getParentKey(item.title, this.state.treeOriginData)
                        currentSelectKeys.push(item.key)
                        !~expandedKeys.indexOf(p) &amp;&amp; expandedKeys.push(p);
                    } else {
                        if (item.children.length > 0) {
                            getExpandKeys(item.children)
                        }
                    }
                });
            }
            getExpandKeys(this.props.treeData)
            // this.props.config.selectedKeys = currentSelectKeys
            expandedKeys.forEach((item) => {
                if (item &amp;&amp; uniqueExpandedKeys.indexOf(item) === -1) {
                    uniqueExpandedKeys.push(item);
                }
            });
        } else {
            currentSelectKeys = uniqueExpandedKeys = ['root']
        }

        this.setState({
            checkedKeys: currentSelectKeys,
            expandedKeys: uniqueExpandedKeys,
            searchValue: value,
            autoExpandParent: true,
        });
    }
    onCheck(key) {
        this.setState({
            checkedKeys: key
        },() => {
            this.props.onCheck(key)
        })
    }
    render () {
        const loop = data => data.map((item) => {
            if (item.children &amp;&amp; item.children.length) {
                return (
                    &lt;NCTree.NCTreeNode
                        title={this.renderTreeTitle(item)}
                        key={item.key}
                        pid = {item.pid}
                        code = {item.code}
                    >
                        {loop(item.children)}
                    &lt;/NCTree.NCTreeNode>
                );
            }
            return (
                &lt;NCTree.NCTreeNode 
                    title={this.renderTreeTitle(item)} 
                    key={item.key}
                    pid = {item.pid}
                    code = {item.code}
                    isLeaf={true}
                    disabled={item.key === '0-0-0'} 
                />
            );
        });
        let data  = this.addIconBox(this.props.treeData)
       
        const treeNodes = loop(data);

        let tree = this.config.showRoot ?
            (
                &lt;NCTree.NCTreeNode
                    className="sn-first-title"
                    title={this.renderTreeTitle(this.props.config.root)}
                >
                    {treeNodes}
                &lt;/NCTree.NCTreeNode>
            ) : (treeNodes);

        return(
            &lt;div id ="sn-hr-tree" className="sn-hr-tree">
                &lt;div style={{display: this.props.showSearch? '': 'none'}}>
                    &lt;NCFormControl
                        style={{ width: 200}}
                        placeholder="Search"
                        value = {this.state.searchValue}
                        onChange={this.onChange}
                    />
                &lt;/div>
                {this.state.showTree?&lt;NCTree
                    {...Object.assign(defaultProps.config,this.props.config)}
                    expandedKeys = {this.state.expandedKeys}
                    defaultExpandedKeys = {this.state.expandedKeys}
                    autoExpandParent={this.state.autoExpandParent}
                    checkedKeys={this.state.checkedKeys}
                    onExpand = {this.onExpand}
                    onCheck={this.onCheck}
                >
                    {tree}
                &lt;/NCTree>:&lt;div>&lt;/div>}
            &lt;/div>
        )
    }
}
Hrtree.propTypes = propTypes;
Hrtree.defaultProps = defaultProps;
export default Hrtree;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Header.html">Header</a></li><li><a href="orgRefer.html">orgRefer</a></li><li><a href="Pagination.html">Pagination</a></li></ul><h3>Global</h3><ul><li><a href="global.html#allCheckTable">allCheckTable</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#formatSelectData">formatSelectData</a></li><li><a href="global.html#sortBtns">sortBtns</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 16:34:25 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
