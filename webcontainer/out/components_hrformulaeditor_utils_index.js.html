<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/hrformulaeditor/utils/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/hrformulaeditor/utils/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 根据类型不同弹不同的模态框
 * @param type
 * @param ctx
 * @param field
 */
import {
    high,
    createPage,
    ajax,
    base,
    toast,
    cacheTools,
    promptBox,
    deepClone,
    getBusinessInfo,
    getMultiLang
} from "nc-lightapp-front";
const {Refer} = high
const handleDataByType = (type, ctx, field, refcode = '') => {
    let flag = true; // 用于标识是否为弹窗类型的操作
    //参照的自定义条件
    let condition = {}
    let map = ctx.state.searchParam.map
    if(map){
        let keys = Object.keys(map)
        let values = Object.values(map)
        values.forEach((value,i)=>{
            condition[keys[i]] = field[value]
        })
        console.log(condition)
    }

    ctx.handleState({
        strCode: field
    })
    switch (type) {
        case '203':
            flag = false

            ctx.handleState({
                comp: 'psntype',
                currentField: field,
                // refQuery:
            }, () => {
                ctx.refs['psntype-refer'].setProps({
                    queryCondition : () => {
                        return {
                            dataTypeid: field.dataTypeid,
                            pk_org: ctx.state.searchParam.pk_org,
                            pk_group: ctx.state.searchParam.groupId
                        }
                    }
                })
                let propsEnu = ctx.refs['psntype-refer'].props
                propsEnu.placeholder = field.displayName
                propsEnu.refname = field.displayName
                propsEnu.refName = field.displayName
                ctx.refs['psntype-refer'].show()
                // ctx.refs["hr-panel-modal"].refs["hr-panel-container-ref"].show()
            })
            break;
        case '204':
            flag = false
            let config = {}
            if (field.strCode === 'bd_psndoc.nativeplace' || field.strCode  === 'bd_psndoc.permanreside') {
                const unitConf = {
                    multiLang: {
                        domainName: 'uapbd',
                        currentLocale: 'zh-CN',
                        moduleId: 'refer_uapbd',
                    },
                    key: 'pk_country',
                    refType: 'grid',
                    refName: 'refer-000444', /* 国际化处理： 国家地区EX*/
                    placeholder: 'refer-000444', /* 国际化处理： 国家地区EX*/
                    refCode: 'uapbd.refer.pubinfo.CountryExDefaultGridRef',
                    queryGridUrl: '/nccloud/uapbd/pub/CountryExDefaultGridRef.do',
                    isMultiSelectedEnabled: false,
                    columnConfig: [{
                        name: ['refer-000002', 'refer-000441', 'refer-000003', 'refer-000422', 'refer-000442', 'refer-000443', 'refer-000445'], /* 国际化处理： 编码,三位代码,名称,描述,时区,格式,欧盟国家*/
                        code: ['refcode', 'codeth', 'refname', 'description', 'timezonename', 'formatname', 'iseucountry'],
                        checked: {
                            description: false,
                            timezonename: false,
                            formatname: false,
                            iseucountry: false,
                        }
                    }]
                };
                config.isShowUnit = true;
                config.unitProps = unitConf;
            } else {
                config = {}
            }
            if (refcode) {
                ctx.refs["hr-refer-loader"].createScript(refcode, config)
                setTimeout(() => {
                    let hrReferProp = ctx.refs["hr-refer"].props
                    let propOrigin = ctx.refs['hr-refer-loader'].state.refer().props
                    getMultiLangJSON(propOrigin.multiLang.moduleId,propOrigin.multiLang.currentLocale,propOrigin.multiLang.domainName,propOrigin)
                    let hrReferLoaderProp = typeof (ctx.refs['hr-refer-loader'].state.refer) === 'function' &amp;&amp; propOrigin
                    hrReferLoaderProp.isShowUnit = true
                    Object.assign(hrReferProp, hrReferLoaderProp)
                    ctx.countryPk = field.para2 || null
                    hrReferProp.queryCondition = () => {
                       return Object.assign(condition, {pk_org: ctx.state.searchParam.pk_org,
                            pk_group: ctx.state.searchParam.groupId,
                            pk_defdoclist: field.para2 || null})
                        // return {
                        //     pk_org: ctx.state.searchParam.pk_org,
                        //     pk_group: ctx.state.searchParam.groupId,
                        //     pk_defdoclist: field.para2 || null
                        // }

                    }
                    if (field.strCode === 'bd_psndoc.nativeplace' || field.strCode  === 'bd_psndoc.permanreside') {
                        ctx.refs["hr-refer"].renderPopoverHeaderExtend = () => {
                            const { unitProps, isShowUnit, unitCondition, defaultUnitValue } = config;
                            let props = { ...unitProps };
                            if (unitCondition) {
                                props = { ...unitProps, queryCondition: unitCondition };
                            }
                            return (
                                isShowUnit &amp;&amp; (
                                    &lt;div style={{ width: '200px', marginLeft: '20px' }}>
                                        &lt;Refer
                                            {...props}
                                            value={ctx.refs["hr-refer"].state.unit}
                                            onChange={(v) => {
                                                // this.loadSelectedData();

                                                ctx.countryPk = v.refpk
                                                ctx.refs["hr-refer"].setState(
                                                    {
                                                        unit: v
                                                    },
                                                    () => {
                                                        ctx.refs["hr-refer"].refresh(false);
                                                    }
                                                );
                                            }}
                                            popWindowClassName={'refer-unit-pop-window'}
                                            // container={this.props.container}
                                        />
                                    &lt;/div>
                                )
                            );
                        };
                    } else {
                        ctx.refs["hr-refer"].renderPopoverHeaderExtend = () => {
                            return null
                        }
                    }
                    ctx.refs["hr-refer"].show()
                }, 100)
            } else {
                flag = true
            }

            break;
        case '205':
            flag = false
            if (refcode) {
                ctx.refs["hr-refer-loader"].createScript(refcode)
                setTimeout(() => {
                    let hrReferProp = ctx.refs["hr-refer"].props
                    let hrReferLoaderProp = typeof (ctx.refs['hr-refer-loader'].state.refer) === 'function' &amp;&amp; ctx.refs['hr-refer-loader'].state.refer().props
                    getMultiLangJSON(hrReferLoaderProp.multiLang.moduleId,hrReferLoaderProp.multiLang.currentLocale,hrReferLoaderProp.multiLang.domainName,hrReferLoaderProp)
                    Object.assign(hrReferProp, hrReferLoaderProp)
                    if (field.strCode === 'bd_psndoc.hi_psnjob') {
                        hrReferProp.queryConditon = () => {
                            return {
                                pk_org: ctx.state.searchParam.pk_org,
                                pk_group: ctx.state.searchParam.groupId
                            }
                        }
                    }
                    // ctx.refs["hr-refer"].setProps(hrReferProp)
                    ctx.refs["hr-refer"].show()
                }, 100)
            } else {
                flag = true
            }
            break;
        case '0':
            if (field.strArguments) {
                flag = false
                if (field.strCode === "wageDays()") {
                    ctx.handleState({
                        comp: 'dataInterval',
                        currentField: field
                    }, () => {
                        ctx.refs["hr-panel-modal"].refs["hr-panel-container-ref"].show()
                    })
                } else if (field.strCode === "taxRate") {
                    ctx.handleState({
                        comp: 'taxFunc',
                        currentField: field
                    }, () => {
                        ctx.refs["hr-panel-modal"].refs["hr-panel-container-ref"].show()
                    })
                } else if (field.strCode === "preAdjustDate()") {
                    ctx.handleState({
                        comp: 'salaryChange',
                        currentField: field
                    }, () => {
                        ctx.refs["hr-panel-modal"].refs["hr-panel-container-ref"].show()
                    })
                }
            }
            break;
        default:
            flag = true
            break;
    }
    return flag
};

// 回写textarea
const handleFieldByType = (data, field) => {
    let str = null

    if (field.strArguments) {
        const handleStr = (handleStr, currentData) => {
            handleStr = handleStr.replace(/({.*?})/g, (e) => {
                return currentData[e.match(/\d/)]
            })
            return handleStr
        }
        // 这几个是写死的
        switch (field.strCode) {
            case "taxRate":
                str = field.strArguments.replace(/(\w+)*/, field.inputSig)
                if (data.val00 === '0') {
                    let d0 = [
                        '0', data.val01, 'null', 'null'
                    ]
                    str = handleStr(str, d0)
                } else if(data.val00 === '1') {
                    let d1 = [
                        '1', data.val11, data.val12, data.val13 || 12
                    ]
                    str = handleStr(str, d1)
                } else {
                    let d1 = [
                        '3', data.val16, data.val14, data.val15, 'null'
                    ]
                    str = handleStr(str, d1)
                }
                break;
            case "wageDays()":
                str = field.strArguments.replace(/(\w+)*/, field.inputSig)
                let d0 = [
                    data.dateStart, data.dateEnd
                ]
                str = handleStr(str, d0)
                break;
            case "preAdjustDate()":

                str = field.strArguments.replace(/(\w+)*/, field.inputSig)
                let d1 = [
                    data.modalValue
                ]
                str = handleStr(str, d1)
                break;
            case '':
                break;
        }
        return str;
    }
}
const getMultiLangJSON = (moduleId, currentLocale, domainName , props) => {
    getMultiLang({
        moduleId,
        currentLocale,
        domainName,
        callback: (json) => {
            props.refName = json[props.refName ]
            props.placeholder = json[props.placeholder]
            if(props.rootNode &amp;&amp; json[props.rootNode.refname]){
                props.rootNode.refname = json[props.rootNode.refname]
            }
        }
    });
};
export default {
    handleDataByType,
    handleFieldByType
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Header.html">Header</a></li><li><a href="Maybe.html">Maybe</a></li><li><a href="orgRefer.html">orgRefer</a></li><li><a href="Pagination.html">Pagination</a></li></ul><h3>Global</h3><ul><li><a href="global.html#allCheckTable">allCheckTable</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#dealHeader">dealHeader</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#fixedCol">fixedCol</a></li><li><a href="global.html#formatSelectData">formatSelectData</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#handleQueryRefer">handleQueryRefer</a></li><li><a href="global.html#handleTableChangeColor">handleTableChangeColor</a></li><li><a href="global.html#snCreateUIDom">snCreateUIDom</a></li><li><a href="global.html#sortBtns">sortBtns</a></li><li><a href="global.html#transRadio">transRadio</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 10:52:13 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
