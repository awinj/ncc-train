<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Transfer/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Transfer/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {Component} from 'react';

import './index.less';

import {base} from 'nc-lightapp-front';

const {
    NCCheckbox
} = base;

/**
 * 
 * leftData : {
 *      key: 11,
 *      display: &lt;div>ddd&lt;/div>,
 *      data: {
 *          name: ''
 *      }
 * }
 * 
 * rightData: => 格式与leftData相同 leftData
 * onChange    function (leftData, rightData)
 * 
 * leftTitle : 
 * rightTitle : 
 */

const allCheckTable = {
    all: {
        checked: true
    },
    none: {
        checked: false
    },
    part: {
        checked: false,
        indeterminate: true
    }
};

class Transfer extends Component {
    constructor(props) {
        super(props);

        this.state = {
            leftAllChecked: '', // 左侧全选按钮状态，all, none，part
            rightAllChecked: '', // 右侧全选按钮状态，all, none，part
            leftChecked: {},
            rightChecked: {}, 
            leftCheckedCount: 0,
            rightCheckedCount: 0,
            leftData: props.leftData,
            rightData: props.rightData,
            leftArrowDisabled: true, // 向左的箭头禁用
            rightArrowDisabled: true, // 向右的箭头禁用
            language: {}, // 多语言
        };

        this.changeCheckBox = this.changeCheckBox.bind(this);
        this.changeAllCheckbox = this.changeAllCheckbox.bind(this);
        this.toChange = this.toChange.bind(this);
        this.getLanguage = this.getLanguage.bind(this);
    }

    componentDidMount() {
        this.getLanguage();
    }

    getLanguage() {
        this.props.MultiInit.getMultiLang({
            domainName: 'hrpub', 
            moduleId: 'hrpub',
            callback: (json, status, init) => {
               this.setState({
                   language: json
               });
            }
        });
    }

    toChange(direction) {
        return () => {
            let {
                leftData, 
                rightData,
                leftChecked,
                rightChecked
            } = this.state;

            if('leftData' in this.props) {
                leftData = this.props.leftData
            }
            if('rightData' in this.props) {
                rightData = this.props.rightData
            }

            if(
                (direction === 'toRight' &amp;&amp; Object.keys(leftChecked).length &lt;= 0)
                || (direction === 'toLeft' &amp;&amp; Object.keys(rightChecked).length &lt;= 0)
             ) {
                return;
            }
            let source = direction === 'toRight' ? [...leftData] : [...rightData];
            let target = direction === 'toRight' ? [...rightData] : [...leftData];
            let checked = direction === 'toRight' ? leftChecked : rightChecked;

            let nSource = [];

            source.map((item, index) => {
                if(checked[item.key] &amp;&amp; checked[item.key].status) {
                    if(target.length > index) {
                        target.splice(index, 0, item);
                    }
                    else {
                        target.push(item);
                    }
                }
                else {
                    nSource.push(item);
                }
            });

            if(direction === 'toLeft') {
                let tmp = nSource;
                nSource = target;
                target = tmp;
            }

            if(this.props.onChange) {
                this.props.onChange(nSource, target);
            }

            this.setState({
                leftData: nSource,
                rightData: target,
                leftChecked: {},
                rightChecked: {}, 
                leftCheckedCount: 0,
                rightCheckedCount: 0,
                leftAllChecked: 'none',
                rightAllChecked: 'none',
            });
        }
    }

    changeAllCheckbox(type) {
        return (status) => {
            let {
                leftData, 
                rightData
            } = this.state;

            if('leftData' in this.props) {
                leftData = this.props.leftData
            }
            if('rightData' in this.props) {
                rightData = this.props.rightData
            }

            let nChecked = {};

            let data = type === 'left' ? leftData : rightData
            
            data.map((item) => {
                nChecked[item.key] = {
                    status: status,
                    data: item
                };
            });

            let checkedName = `${type}Checked`;
            let checkedAllName = `${type}AllChecked`;

            let typeCount = `${type}CheckedCount`;

            this.setState({
                [checkedName]: nChecked,
                [checkedAllName]: status ? 'all' : 'none',
                [typeCount]: status ? data.length : 0
            });
        }
    }

    changeCheckBox(item, type) {
        return (status) => {
            let {
                leftChecked, 
                leftCheckedCount,
                rightChecked,
                rightCheckedCount,
                leftData,
                rightData
            } = this.state;

            if('leftData' in this.props) {
                leftData = this.props.leftData
            }
            if('rightData' in this.props) {
                rightData = this.props.rightData
            }
            
            let allChecked = '';
            let nCount = 0;
            
            if(type === 'left'){
                nCount = status ? leftCheckedCount + 1 : leftCheckedCount - 1;
            }
            else {
                nCount = status ? rightCheckedCount + 1 : rightCheckedCount - 1;
            }

            if(nCount === 0) {
                allChecked = 'none';
            }
            else if(
                (type === 'left' &amp;&amp; nCount === leftData.length) 
                || (type === 'right' &amp;&amp; nCount === rightData.length)
            ) {
                allChecked = 'all';
            }
            else {
                allChecked = 'part';
            }

            if(type === 'left') {
                this.setState({
                    leftChecked: {
                        ...leftChecked,
                        [item.key]: {
                            status: status,
                            data: item
                        }
                    },
                    leftCheckedCount: nCount,
                    leftAllChecked: allChecked
                }, () => {
                    if(this.props.onChecked) {
                        this.props.onChecked &amp;&amp; this.props.onChecked(type, this.state.leftChecked);
                    }
                });
            }
            else {
                this.setState({
                    rightChecked: {
                        ...rightChecked,
                        [item.key]: {
                            status: status,
                            data: item
                        }
                    },
                    rightCheckedCount: nCount,
                    rightAllChecked: allChecked
                }, () => {
                    this.props.onChecked &amp;&amp; this.props.onChecked(type, this.state.rightChecked);
                });
            }
        }
    }

    componentWillReceiveProps(props) {
        if(this.props.leftData !== props.leftData) {
            this.setState({
                leftAllChecked: 'none'
            });
        }
    }

    render() {
        const {
            leftTitle,
            rightTitle,
            leftData:  propsLeftData, 
            rightData: propsRightData,
            className,
            style = {}
        } = this.props;

        let {
            leftAllChecked,
            leftChecked,
            rightAllChecked,
            rightChecked,
            leftData = [],
            rightData = [],
            leftCheckedCount,
            rightCheckedCount,
            language
        } = this.state;

        propsLeftData &amp;&amp; (leftData = propsLeftData)
        propsRightData &amp;&amp; (rightData = propsRightData);

        let rightArrowDisabled = leftCheckedCount &lt;= 0;
        let leftArrowDisabled = rightCheckedCount &lt;= 0;

        return (
            &lt;div 
                className={`transfer-wrapper ${className || ''}`}
                style={style}
            >
                &lt;div className="transfer-box">
                    {
                        !leftTitle &amp;&amp; !rightTitle ? null :
                        &lt;div className="transfer-list-title">
                            {leftTitle ? leftTitle : ''}
                        &lt;/div>
                    }
                    &lt;div className="transfer-left-wrapper">
                        &lt;div className="transfer-title-wrapper">
                            &lt;NCCheckbox
                                {...allCheckTable[leftAllChecked]}
                                onChange={this.changeAllCheckbox('left')}
                            >
                                {language['hrpub-000071']/** 全选 */}
                            &lt;/NCCheckbox>
                        &lt;/div>
                        {leftData.map((item, index) => {
                            return (
                                &lt;div className="transfer-item-wrapper">
                                    {item.prefix || null}
                                    &lt;NCCheckbox
                                        checked={leftChecked[item.key] &amp;&amp; leftChecked[item.key].status}
                                        onChange={this.changeCheckBox(item, 'left')}
                                    >
                                        {item.display}
                                    &lt;/NCCheckbox>
                                    {item.suffix || null}
                                &lt;/div>
                            );
                        })}
                    &lt;/div>
                &lt;/div>
                &lt;div className="transfer-operation-wrapper">
                    &lt;div className="transfer-operation-button-list">
                        &lt;div 
                            className={`transfer-operation-button-wrapper ${rightArrowDisabled &amp;&amp; 'disabled'}`}
                            onClick={this.toChange('toRight')}
                        >
                            >
                        &lt;/div>
                        &lt;div 
                            className={`transfer-operation-button-wrapper ${leftArrowDisabled &amp;&amp; 'disabled'}`}
                            onClick={this.toChange('toLeft')}
                        >
                            {'&lt;'}
                        &lt;/div>
                    &lt;/div>
                &lt;/div>
                &lt;div className="transfer-box">
                    {
                        !leftTitle &amp;&amp; !rightTitle ? null :
                        &lt;div className="transfer-list-title">
                            {rightTitle ? rightTitle : ''}
                        &lt;/div>
                    }
                    &lt;div className="transfer-right-wrapper">
                        &lt;div className="transfer-title-wrapper">
                            &lt;NCCheckbox
                                {...allCheckTable[rightAllChecked]}
                                onChange={this.changeAllCheckbox('right')}
                            >
                                {language['hrpub-000071']/** 全选 */}
                            &lt;/NCCheckbox>
                        &lt;/div>
                        {rightData.map((item, index) => {
                            return (
                                &lt;div className="transfer-item-wrapper">
                                    {item.prefix || null}
                                    &lt;NCCheckbox
                                        checked={rightChecked[item.key] &amp;&amp; rightChecked[item.key].status}
                                        onChange={this.changeCheckBox(item, 'right')}
                                    >
                                        {item.display}
                                    &lt;/NCCheckbox>
                                    {item.suffix || null}
                                &lt;/div>
                            );
                        })}
                    &lt;/div>
                &lt;/div>
            &lt;/div>
        );
    }
}

export default Transfer;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Header.html">Header</a></li><li><a href="orgRefer.html">orgRefer</a></li><li><a href="Pagination.html">Pagination</a></li></ul><h3>Global</h3><ul><li><a href="global.html#allCheckTable">allCheckTable</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#formatSelectData">formatSelectData</a></li><li><a href="global.html#sortBtns">sortBtns</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 16:34:25 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
