<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by wanghongxiang on 2018/7/7.
 */
import {ajax, toast} from 'nc-lightapp-front';

const formatDate = (time, separator = '-', type = 'yyyy-MM-dd') => {
    if (!time &amp;&amp; typeof (time) !== 'number') {
        return ''
    }
    // 后台返回的时间戳可能是字符串类型的可能是几个时间戳
    let ary = []
    let date
    if (time instanceof Date) {
    } else {
        time = time &amp;&amp; parseInt(time)
    }
    date = new Date(time)
    let year = date.getFullYear()
    let month = date.getMonth() &lt; 9 ? `0${date.getMonth() + 1}` : date.getMonth() + 1
    let day = date.getDate() &lt; 10 ? `0${date.getDate()}` : date.getDate()
    let hour = date.getHours() &lt; 10 ? `0${date.getHours()}` : date.getHours()
    let min = date.getMinutes() &lt; 10 ? `0${date.getMinutes()}` : date.getMinutes()
    let sec = date.getSeconds() &lt; 10 ? `0${date.getSeconds()}` : date.getSeconds()
    switch (type) {
        case 'YY-MM':
            ary = [year, month]
            break
        case 'YY-MM-DD':
            ary = [year, month, day]
            break
        case 'hh-mm':
            ary = [hour, min]
            break
        case 'hh-mm-ss':
            ary = [hour, min, sec]
            break
        case 'MM-dd':
            ary = [month, day]
            break
        // 假勤单据只显示到分
        case 'Y-M-d-h-m-0':
            let str5 = [year, month, day].join('-')
            let str6 = [hour, min, '00'].join(':')
            ary = [str5, str6]
            break
        case 'Y-M-d-h-m-s':
            let str1 = [year, month, day].join('-')
            let str2 = [hour, min, sec].join(':')
            ary = [str1, str2]
            break
        // 配合导出表格的文件名。。。
        case 'y-m-d-h-m-s':
            let str3 = [year, month, day].join('-')
            let str4 = [hour, min, sec].join('-')
            ary = [str3, str4]
            break
        // 显示到分
        case 'y-m-d-h-m':
            let str7 = [year, month, day].join('/')
            let str8 = [hour, min].join(':')
            ary = [str7, str8]
            break
        // mm-dd hh:mm
        case 'm-d-h-m':
            let str9 = [month, day].join('/')
            let str10 = [hour, min].join(':')
            ary = [str9, str10]
            break
        case 'Y-M-d h-m-s':
            let str11 = [year, month, day].join('-')
            let str12 = ' ' + [hour, min, sec].join(':')
            ary = [str11, str12]
            break
        default:
            ary = [year, month, day]
    }
    return ary.join(separator)
}

/**
 * 更改radio样式
 * @param {*} form 表单数据，或者table中的行数据
 * @param {*} dbdata 后台返回的数据 true/false 或者 'true'/'false'
 * @param {*} dbdata  模板中对应的数据
 * @param {*} keyArrays 需要更改的字符串数组
 */
const transRadio = (form, dbdata, tempdata, keyArrays, tempShowname) => {
    //需要区分form 和table
    let rows;
    if (!form.rows) {
        rows = form;
    } else {
        rows = form.rows;
    }
    keyArrays.map(key => {
        let handleData = (d) => {
            if (!d.values[key]) {
                d.values[key] = {
                    value: false
                }
            }
            if (tempdata[0] === 'Y') {
                //薪资档案 可能为空
                if (d.values[key]) {
                    //已经翻译过的不用再次翻译
                    if (d.values[key].value != tempdata[0] &amp;&amp; d.values[key].value != tempdata[1]) {
                        d.values[key].display = d.values[key].value === dbdata ? (d.values[key].value === dbdata ? tempShowname[0] : tempShowname[1]) : tempShowname[1];
                        /* 国际化处理： 是,否,否*/
                        d.values[key].value = d.values[key].value === dbdata ? (d.values[key].value === dbdata ? tempdata[0] : tempdata[1]) : tempdata[1];
                    }
                }
            } else {
                if (d.values[key]) {
                    //已经翻译过的不用再次翻译
                    if (d.values[key].value.toString() != tempdata[0].toString() &amp;&amp; d.values[key].value.toString() != tempdata[1].toString()) {
                        d.values[key].display = d.values[key].value === 'true' ? (d.values[key].value === dbdata ? tempShowname[0] : tempShowname[1]) : tempShowname[1];
                        /* 国际化处理： 是,否,否*/
                        d.values[key].value = d.values[key].value === 'true' ? (d.values[key].value === dbdata ? tempdata[0] : tempdata[1]) : tempdata[1];
                    }
                }
            }

        }

        //如果没有这个属性，加进来，并且设置默认值为false
        if (Array.isArray(rows)) {
            for (let i of rows) {
                handleData(i)
            }
        } else {
            handleData(rows)
        }
    })
    if (Array.isArray(rows)) {
        return {rows: rows};
    } else {
        return {rows: [rows]};
    }

}
/**
 * 处理表格变色增加render
 * @param {需要变颜色的字段map} changeColorMap
 * @param {meta名字} metaName
 * @param {框架中的内置Props} props
 * @param {需要处理的模板数据template_data} template_data
 */
/**
 * 后端数据格式 changeColorMap :{f_79: ["1", "3", "0"]}
 * key是field名，数组是列
 * ***/
const handleTableChangeColor = (changeColorMap, metaName, props, template_data) => {
    let metaCurrent = template_data;
    let fields = Object.keys(changeColorMap)
    if (fields.length &lt; 1) {
        props.meta.addMeta({[metaName]: metaCurrent});
        return
    }
    for (let i of metaCurrent.items) {
        if (fields.indexOf(i.attrcode) > -1) {
            let scale = Number(i.scale)
            // i.itemtype = "customer"
            i.renderStatus = 'browse'
            i.render = (a, b, c) => {
                let val;
                let color;
                if(a) {
                    if (a.values !== undefined) {
                        val = a.values[i.attrcode] &amp;&amp; a.values[i.attrcode].value
                    } else {
                        val = a[i.attrcode].value
                    }
                } else {
                    if (b.values !== undefined) {
                        val = b.values[i.attrcode] &amp;&amp; b.values[i.attrcode].value
                    } else {
                        val = b[i.attrcode].value
                    }
                }

                if (val &amp;&amp; val.toString() === 'true') {
                    val = '是'
                } else if (val &amp;&amp; val.toString() === 'false') {
                    val = '否'
                } else {
                    val = val
                }
                if (changeColorMap[i.attrcode].indexOf(c + "") > -1) {
                    return &lt;span
                        style={{color: 'red'}}>{(Number.isNaN(Number(val)) || (val !== '' || val !== null || val !== undefined)) ? val : Number(val).toFixed(scale)}&lt;/span>
                } else {
                    return &lt;span
                        style={{color: '#555555'}}>{(Number.isNaN(Number(val)) || (val !== '' || val !== null || val !== undefined)) ? val : Number(val).toFixed(scale)}&lt;/span>
                }
            }
        } else {
            let scale = Number(i.scale)
            if (i.attrcode !== "opr") {
                // i.itemtype = "customer"
                // i.render = (a,b,c) => {
                //     let val;
                //     let color;
                //     if(a&amp;&amp;a.values!== undefined){
                //         val = a.values[i.attrcode] &amp;&amp; a.values[i.attrcode].value
                //     }else{
                //         val = b.values[i.attrcode].value
                //     }
                //     return &lt;span style={{color: '#555555'}}>{Number.isNaN(Number(val))? val : Number(val).toFixed(scale)}&lt;/span>
                // }
            }
        }
    }
    props.meta.addMeta({[metaName]: metaCurrent});
}
/**
 * 合并请求
 * @param config
 * @param reqData
 * @param callback
 */
/**
 let reqData = [
 {
     rqUrl: '/platform/templet/querypage.do',
     rqJson: `{\n  \"pagecode\": \"${pagecode}\",\n  \"appcode\": \"${appcode}\"\n}`,
     rqCode: 'template'
 },
 {
     "rqUrl": '/hrwa/paydata/QueryTempleteAction.do',
     "rqJson": `{typeCode: 'table', pk_org: '${this.state.pk_org}', pk_wa_class: '${this.state.pk_wa_class}', cyear: '${this.state.cyear}', cperiod: '${this.state.cperiod}'}`,
     "rqCode": "template_table"
 },
 {
     "rqUrl": '/hrwa/paydata/QueryTempleteAction.do',
     "rqJson": `{typeCode: 'form', pk_org: '${this.state.pk_org}', pk_wa_class: '${this.state.pk_wa_class}', cyear: '${this.state.cyear}', cperiod: '${this.state.cperiod}'}`,
     "rqCode": "template_form"
 },
 {
     "rqUrl": '/hrwa/paydata/WaPaydataSpecialInitAction.do',
     "rqJson": `{ pk_org: '${this.state.pk_org}', pk_wa_class: '${this.state.pk_wa_class}', cyear: '${this.state.cyear}', cperiod: '${this.state.cperiod}'}`,
     "rqCode": "special_template"
 },
 {
     rqUrl: '/platform/appregister/queryallbtns.do',
     rqJson: `{\n  \"pagecode\": \"${pagecode}\",\n  \"appcode\": \"${appcode}\"\n}`,
     rqCode: 'button'
 },
 {
     rqUrl: '/platform/appregister/queryappcontext.do',
     rqJson: `{\n  \"appcode\": \"${appcode}\"}`,
     rqCode: 'context'
 }
 ];
 **/
const snCreateUIDom = (config, reqData = [], callback) => {
    if (config.billtype) {
        //根据billtype查appcode
        let sencetype = "1"
        ajax({
            url: '/nccloud/platform/pub/getappurl.do',
            method: 'post',
            data: {
                billpk: null,
                billtypecode: config.billtype,
                pagecode: config.pagecode || null,
                sence: config.sence || sencetype
            },
            success: (result) => { //查询成功后请求模板
                if (result.success &amp;&amp; result.data &amp;&amp; result.data.appPageVO) {
                    let appcode = result.data.appcode;
                    let pagecode = config.pagecode || result.data.appPageVO.pagecode;
                    this.requestMeta(appcode, pagecode, callback);
                }
            }
        })
    } else {
        let code = '';
        let page = '';
        let appUrl = window.parent.location.hash.split('?');
        if (appUrl &amp;&amp; appUrl[1]) {
            let appPrams = appUrl[1].split('&amp;');
            if (appPrams &amp;&amp; appPrams instanceof Array) {
                appPrams.forEach((item) => {
                    if (item.indexOf('=') != -1 &amp;&amp; item.split('=') &amp;&amp; item.split('=') instanceof Array) {
                        if (item.split('=')[0] === 'c') {
                            if (item.split('=')[1]) {
                                code = decodeURIComponent(decodeURIComponent(item.split('=')[1]));
                            }
                        }
                        if (item.split('=')[0] === 'p') {
                            if (item.split('=')[1]) {
                                page = decodeURIComponent(decodeURIComponent(item.split('=')[1]));
                            }
                        }
                    }
                });
            }
        }
        let pagecode = config.pagecode || page;
        let appcode = config.appcode || code;
        snRequestMeta(appcode, pagecode, reqData, callback);
    }
}

const snRequestMeta = (appcode, pagecode, reqData, callback) => {
    ajax({
        url: '/nccloud/platform/pub/mergerequest.do',
        data: reqData,
        success: function (res) {
            let meta = res.data;
            if (callback &amp;&amp; typeof callback == 'function') {
                callback(meta);
            }
        }
    });
}
/**
 *
 * @param template 需要固定列的模版
 * @param colMap 需要固定的列数组
 */
const fixedCol = (template, colMap, json) => {
    let items = template.items
    items.unshift({
        attrcode: "numberindex",
        className: "table-index",
        dataIndex: "numberindex",
        itemtype: "customer",
        label: json, /* 国际化处理： 序号*/
        title: json, /* 国际化处理： 序号*/
        visible: true,
        width: "60px",
        fixed: 'left'
    })
    items.forEach((items) => {
        if (colMap.indexOf(items.attrcode) > -1) {
            items.fixed = 'left'
        }
    })

}
/**
 *给查询模板赋默认值
 * @param template 需要固定列的模版
 * @param colMap 需要固定的列数组
 */
const handleQueryRefer = (temp, value) => {
    let items = temp.items
    items.map(val => {
        if (val.itemtype === 'refer') {
            val.queryCondition = function () {
                return {
                    "pk_org": value.pk_org
                }
            }
        }
    })
    return temp
}

const languageCreateUIDOM = (props) => {
    return (pageCfg = {}, langCfg = {}, callback) => {

        var count = 0;
        var result = {};

        var hander = () => {
            if (count == 2) {
                callback &amp;&amp; callback(result.templateData || {}, result.langData || {}, result.inlt || {});
            }
        }
        if (langCfg.callback) {
        }

        var newLangCfg = {
            ...langCfg, callback: (data, success, inlt) => {
                count = count + 1;
                if (!success) {
                    toast({content: 'load muti lang error', color: 'warning'});
                }
                result.langData = data || {};
                result.inlt = inlt || {};
                hander();
            }
        };
        props.MultiInit.getMultiLang(newLangCfg);

        props.createUIDom(pageCfg, (data) => {
            count = count + 1;
            result.templateData = data || {};
            hander();
        });
    };

}

const myBrowser = () => {
    const userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
    const isOpera = userAgent.indexOf('Opera') > -1;
    if (isOpera) {
        //判断是否Opera浏览器
        return 'Opera';
    }
    if (userAgent.indexOf('Firefox') > -1) {
        //判断是否Firefox浏览器
        return 'FF';
    }
    if (userAgent.indexOf('Chrome') > -1) {
        return 'Chrome';
    }
    if (userAgent.indexOf('Safari') > -1) {
        //判断是否Safari浏览器
        return 'Safari';
    }
    if (!!window.ActiveXObject || 'ActiveXObject' in window) {
        return 'IE';
    }
};

//判断浏览器类型
const getUserAgent = () => {
    var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
    //判断是否Opera浏览器
    if (userAgent.indexOf("Opera") > -1) {
        return "Opera";
    }
    //判断是否Firefox浏览器
    if (userAgent.indexOf("Firefox") > -1) {
        return "FF";
    }
    //判断是否chorme浏览器
    if (userAgent.indexOf("Chrome") > -1) {
        return "Chrome";
    }
    //判断是否Safari浏览器
    if (userAgent.indexOf("Safari") > -1) {
        return "Safari";
    }
    //判断是否IE浏览器
    if (
        userAgent.indexOf("compatible") > -1 &amp;&amp;
        userAgent.indexOf("MSIE") > -1 &amp;&amp;
        !isOpera
    ) {
        return "IE";
    }
    //判断是否Edge浏览器
    if (userAgent.indexOf("Trident") > -1) {
        return "Edge";
    }
}
/**
 * 函数防抖
 * @param fn  要执行的方法
 * @param delay  最短间隔时间
 * @returns {Function}
 */
const debounce = (fn, delay = 200) => {
    // 维护一个 timer
    let timer = null;

    return function () {
        // 通过 ‘this’ 和 ‘arguments’ 获取函数的作用域和变量
        let context = this;
        let args = arguments;
        clearTimeout(timer);
        timer = setTimeout(function () {
            fn.apply(context, args);
        }, delay);
    }
};
/**
 * 链式获取特定值
 * 用法如下：     
 * import {Maybe} from 'src/hrpub/common/utils/utils'
 * Maybe.of(result).getValue(['data', 'paydata', 'wa_data', 'rows[0]'])
 *   
 console.log(Maybe.of({
    a: {
        b: {
        c: [{
            d: 4
        }]
        }
    }
    }).getValue(['a', 'b', 'c[0]', 'd']))  // 4 若无值返回undefined
 * 
 * 
 */
export class Maybe {
    constructor (val) {
      this.__value = val
      this.cacheValue = null
    }
    static of (val) {
      return new Maybe(val)
    }
    setValue (val) {
      let cache = !this.cacheValue ? this.__value : this.cacheValue
      if (new RegExp(/\[\d+\]/g).test(val)) {
        let num = val.match(new RegExp(/(?!\[)(\d+)(?=\])/g))[0]
        let name = val.match(new RegExp(/^\w*(?=\[)/g))[0]
        this.cacheValue = cache[name][num]
        return
      }
      this.cacheValue = cache[val]
    }
    getValue (args) {
      args.map(obj => {
        this.setValue(obj)
      })
      return this.cacheValue
    }
  }
export {
    formatDate,
    transRadio,
    snCreateUIDom,
    handleTableChangeColor,
    fixedCol,
    handleQueryRefer,
    languageCreateUIDOM,
    getUserAgent,
    debounce,
    myBrowser
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Header.html">Header</a></li><li><a href="Maybe.html">Maybe</a></li><li><a href="orgRefer.html">orgRefer</a></li><li><a href="Pagination.html">Pagination</a></li></ul><h3>Global</h3><ul><li><a href="global.html#allCheckTable">allCheckTable</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#dealHeader">dealHeader</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#fixedCol">fixedCol</a></li><li><a href="global.html#formatSelectData">formatSelectData</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#handleQueryRefer">handleQueryRefer</a></li><li><a href="global.html#handleTableChangeColor">handleTableChangeColor</a></li><li><a href="global.html#snCreateUIDom">snCreateUIDom</a></li><li><a href="global.html#sortBtns">sortBtns</a></li><li><a href="global.html#transRadio">transRadio</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 10:52:13 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
