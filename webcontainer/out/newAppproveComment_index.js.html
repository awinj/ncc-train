<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: newAppproveComment/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: newAppproveComment/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {Component} from 'react';

import {high,ajax,toast,base} from 'nc-lightapp-front';
const { ApproveCommentContain,CommentList,ApproveBtns,ApproveDetail,MulTargetTransfer,NCUploader } = high;
import PropTypes from "prop-types";

const peopleToHeavy = (topTargetKeys,bottomTargetKeys) => {//去除重复的选定人，生成数目
    let arr = topTargetKeys.concat();
    bottomTargetKeys.map( (item, index) => {
        !arr.includes(item) &amp;&amp; arr.push(item)
    })
    return arr.length;
}
class NewApproveComment extends ApproveCommentContain {
    static contextTypes = {
        self: PropTypes.object,
        ctx: PropTypes.object,
    }
    constructor(props) {
        super(props);
        this.state = {

            //审批详情
            showApproveModal: false,

            //审批意见
            comment: this.props.checknote || '',
            track: false,

            //审批按钮
            btns: this.props.btns ||[],
            hintMessage: this.props.hintMessage,
            billMessage: this.props.billMessage ||{},
            //附件
            showUploader: false,

            //抄送用户
            userModal: false,

            //另数据的key===人员id
            dataSource: [],
            topTargetKeys: [],
            bottomTargetKeys: [],
            json: {},
            inlt: null,

            attrfiles: [],//已上传附件信息,
        };
    }



    render() {
        let { NCCheckbox, NCTextArea , NCButton,NCModal} = base;
        const { Header, Title, Body, Footer } = NCModal;
        const {
            track,
            showApproveModal,
            btns,
            comment,
            billMessage,
            showUploader,
            //抄送用户
            userModal,
            dataSource,
            topTargetKeys,
            bottomTargetKeys,
            hintMessage,
            attachcount,
            attrfiles,
            json,
        } = this.state;
        let {showRevocation} = this.props

        let sendUsers = {
            'message': topTargetKeys,
            'mail': bottomTargetKeys
        }

        return &lt;div>

            &lt;div className="approve-comment">

                &lt;div className="approve-comment-text">
                    &lt;NCTextArea
                        placeholder={json['index_004'] + ":"} // index_004 审批意见
                        className="comment-text"
                        value={comment}
                        showMax={true}
                        max={200}
                        canResize={false}
                        onChange={(val) => {
                            if (val != comment) {
                                this.setState({
                                    comment: val
                                })
                            }
                        }}
                    />
                    {/* 常用审批意见 */}
                    &lt;CommentList
                        onChange={this.changeCommentList}
                    />
                &lt;/div>

                &lt;div className="comment-sel" style={{display:billMessage.approveType ?'':'none'}}>

                    &lt;NCCheckbox
                        className="sel-item"
                        checked={track}
                        disabled
                        onChange={(ff) => {
                            this.setState({
                                track: ff
                            })
                        }}
                    >
                        {/* index_006 追踪 */}
                        {json['index_006']}
                    &lt;/NCCheckbox>

                    &lt;span className="sel-item" onClick={this.context.self.showApproveDetail.bind(this.context.self)}>{json['index_007']}&lt;/span>
                    {/* index_007 审批详情 */}

                    &lt;span
                        className="sel-item"
                        onClick={this.openUserModal}>
                        {/* index_008 抄送用户 index_009 人 */}
                        {`${json['index_008']}${peopleToHeavy(topTargetKeys,bottomTargetKeys)}${json['index_009']}`}
					&lt;/span>

                &lt;/div>

                &lt;div className="comment-btns">

                    {/* 审批流程按钮 */}
                    &lt;ApproveBtns
                        btns={btns}
                        hintMessage = {hintMessage}
                        attrfiles = {attrfiles}
                        // btns={["nopass", "transfer", "reject", "addapprover", "pass", 'revocation', 'opinions']}
                        comment={comment}
                        showRevocation={showRevocation}
                        sendUsers = {sendUsers}
                        billMessage={billMessage}
                        onHandleSuccess={this.context.self.handleSuccess.bind(this.context.self)}
                    />

                    {/* 上传附件按钮 */}
                    &lt;span
                        className='iconfont comment-icon icon-fujianshenpi'
                        onClick={(eve) => {
                            this.setState({
                                showUploader: true
                            });
                        }}
                    >&lt;i>{this.state.billMessage &amp;&amp; this.state.billMessage.attachcount}&lt;/i>&lt;/span>

                &lt;/div>

            &lt;/div>

            &lt;NCModal show = {
                this.state.show
            }
                     onHide = {
                         this.close
                     } style={{textAlign:'center'}}>
                &lt;NCModal.Header>
                    &lt;NCModal.Title>&lt;/NCModal.Title>{/* 国际化处理： 审批操作*/}
                &lt;/NCModal.Header>
                &lt;NCModal.Body>
                    {/* 审批详情 */}
                    &lt;ApproveDetail
                        show={showApproveModal}
                        close={() => {
                            this.setState({
                                showApproveModal: false
                            });
                        }}
                        billtype={billMessage &amp;&amp; billMessage.billtype}  //billMessage.billtype
                        billid={billMessage &amp;&amp; billMessage.billid}  //billMessage.billid
                    />
                &lt;/NCModal.Body>
                &lt;NCModal.Footer style={{textAlign:'center'}}>
                &lt;/NCModal.Footer>
            &lt;/NCModal>



            {/* 抄送用户 */}
            &lt;NCModal
                show={this.state.userModal}
                onHide={this.closeUserModal}
                className='user-modal'
                backdrop={true}
                size = "lg"
            >
                &lt;Header closeButton>
                    {/* index_010 用户选择 */}
                    &lt;Title>{json['index_010']}&lt;/Title>
                &lt;/Header >
                &lt;Body>
                &lt;MulTargetTransfer
                    className='send-user'
                    showSortBtn={false}
                    titles={this.titles}
                    onChange={this.onChange}
                    dataSource={dataSource}
                    topTargetKeys={topTargetKeys}
                    bottomTargetKeys={bottomTargetKeys}
                />
                &lt;/Body>
                &lt;Footer>
                    {/* index_011 确定 */}
                    &lt;NCButton colors='primary' onClick={this.sendUsers}>{json['index_011']}&lt;/NCButton>
                    {/* index_012 关闭 */}
                    &lt;NCButton colors='close' onClick={this.closeUserModal}>{json['index_012']}&lt;/NCButton>
                &lt;/Footer>
            &lt;/NCModal>



            {/* 上传附件 */}
            {showUploader &amp;&amp; &lt;NCUploader
                billId={this.props.pk_checkflow}
                customize={{storepath:'riamsgattachfiles'}}
                isApprove={true}
                disableDownload={true}
                canDownLoad={false}
                getGroupList={this.getGroupList.bind(this)}
                onHide={()=>{
                    this.setState({
                        showUploader: false
                    })
                }}
            />
            }


        &lt;/div>
    }


}
export  default  NewApproveComment;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Header.html">Header</a></li><li><a href="orgRefer.html">orgRefer</a></li><li><a href="Pagination.html">Pagination</a></li></ul><h3>Global</h3><ul><li><a href="global.html#allCheckTable">allCheckTable</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#formatSelectData">formatSelectData</a></li><li><a href="global.html#sortBtns">sortBtns</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 16:34:25 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
